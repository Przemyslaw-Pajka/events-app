<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"
    ></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <link
      href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 500px;
      }
      /* Optional: Makes the sample page fill the window. */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #description {
        font-family: Roboto;
        font-size: 15px;
        font-weight: 300;
      }

      #infowindow-content .title {
        font-weight: bold;
      }

      #infowindow-content {
        display: none;
      }

      #map #infowindow-content {
        display: inline;
      }

      .pac-card {
        margin: 10px 10px 0 0;
        border-radius: 2px 0 0 2px;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        outline: none;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        background-color: #fff;
        font-family: Roboto;
      }

      #pac-container {
        padding-bottom: 12px;
        margin-right: 12px;
      }

      .pac-controls {
        display: inline-block;
        padding: 5px 11px;
      }

      .pac-controls label {
        font-family: Roboto;
        font-size: 13px;
        font-weight: 300;
      }
      .gm-style {
        position: relative;
      }
      #pac-input {
        background-color: #fff;
        font-family: Roboto;
        font-size: 15px;
        font-weight: 300;
        margin-left: 12px;
        padding: 0 11px 0 13px;
        text-overflow: ellipsis;
        width: 50%;
        padding: 5px 12px;
        top: 12px !important;
        left: 12px !important;
        margin: 0 !important;
        border: 1px solid #dcdada;
        box-shadow: 1px 1px 7px #646464;
      }
      #pac-input::placeholder {
        color: gray;
      }
      #pac-input:focus {
        border-color: #4d90fe;
      }

      #title {
        color: #fff;
        background-color: #4d90fe;
        font-size: 25px;
        font-weight: 500;
        padding: 6px 12px;
      }
      #target {
        width: 345px;
      }
      #latlng {
        width: 225px;
      }
    </style>
    <title>Events app</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <script>
      // This example adds a search box to a map, using the Google Place Autocomplete
      // feature. People can enter geographical searches. The search box will return a
      // pick list containing a mix of places and predicted search terms.

      // This example requires the Places library. Include the libraries=places
      // parameter when you first load the API. For example:
      // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">

      function getCityLocation(cityLocation) {
        document.getElementById("cityLocationInput").value = cityLocation;
      }
      function initAutocomplete() {
        let infoWindow = new google.maps.InfoWindow();
        var geocoder = new google.maps.Geocoder();
        var map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: -33.8688, lng: 151.2195 },
          zoom: 13,
          mapTypeId: "roadmap",
        });
        var pos;

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            function (position) {
              pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
              };
              document.getElementById("latFld").value = pos.lat;
              document.getElementById("lngFld").value = pos.lng;

              marker.setPosition(pos);
              infoWindow.setContent("Location found.");

              infoWindow.open(map);
              //
              console.log(infoWindow);
              geocodeLatLng(geocoder, map, infoWindow, marker, pos);
              //
              map.setCenter(pos);
            },
            function () {
              handleLocationError(true, infoWindow, map.getCenter());
            }
          );
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
          infoWindow.setPosition(pos);
          infoWindow.setContent(
            browserHasGeolocation
              ? "Error: The Geolocation service failed."
              : "Error: Your browser doesn't support geolocation."
          );
          infoWindow.open(map);
        }

        // Create the search box and link it to the UI element.
        var input = document.getElementById("pac-input");
        var searchBox = new google.maps.places.SearchBox(input);
        map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

        // Bias the SearchBox results towards current map's viewport.
        map.addListener("bounds_changed", function () {
          searchBox.setBounds(map.getBounds());
        });

        var marker = new google.maps.Marker({
          map: map,
          draggable: true,
          animation: google.maps.Animation.DROP,
          position: { lat: 59.327, lng: 18.067 },
        });

        // add a click event handler to the map object
        google.maps.event.addListener(map, "click", function (event) {
          var geocoder = new google.maps.Geocoder();
          console.log("clicked");

          // display the lat/lng in your form's lat/lng fields
          document.getElementById("latFld").value = event.latLng.lat();
          document.getElementById("lngFld").value = event.latLng.lng();

          // place a marker
          placeMarker(event.latLng, geocoder, infoWindow, {
            lat: event.latLng.lat(),
            lng: event.latLng.lng(),
          });

          var marker_position = event.latLng;
          toggleBounce();
          marker.setPosition(marker_position);
        });

        // Listen for the event fired when the user selects a prediction and retrieve
        // more details for that place.
        searchBox.addListener("places_changed", function () {
          var places = searchBox.getPlaces();
          map.setCenter(places[0].geometry.location);
          console.log(places[0].geometry.location.lat());
          document.getElementById(
            "latFld"
          ).value = places[0].geometry.location.lat();
          document.getElementById(
            "lngFld"
          ).value = places[0].geometry.location.lng();
          if (places.length == 0) {
            return;
          }

          // For each place, get the icon, name and location.

          var marker_position = places[0].geometry.location;

          marker.setPosition(marker_position);
          console.log("in search box", {
            lat: places[0].geometry.location.lat(),
            lng: places[0].geometry.location.lng(),
          });
          //
          geocodeLatLng(geocoder, map, infoWindow, marker, {
            lat: places[0].geometry.location.lat(),
            lng: places[0].geometry.location.lng(),
          });
          //
          toggleBounce();
          map.fitBounds(bounds);
        });
        function placeMarker(location, geocoder, infoWindow, pos) {
          marker.position = location;
          marker.map = map;

          geocodeLatLng(geocoder, map, infoWindow, marker, pos);
          map.setCenter(location);
        }

        function toggleBounce() {
          window.setTimeout(function () {
            marker.setAnimation(null);
          }, 800);
          marker.setAnimation(google.maps.Animation.BOUNCE);
        } //
      }
      function geocodeLatLng(geocoder, map, infowindow, marker, pos) {
        var input = document.getElementById("latlng").value;
        var latlngStr = input.split(",", 2);
        var latlng = {
          lat: pos.lat,
          lng: pos.lng,
        };

        geocoder.geocode({ location: latlng }, function (results, status) {
          if (status === "OK") {
            if (results[0]) {
              map.setZoom(11);

              //console.log(results[0].address_components);
              let filtered = results[0].address_components.filter((element) => {
                for (let i in element.types) {
                  return element.types[i] == "locality";
                }
              });
              console.log("filtered element is: ", filtered[0].long_name);
              getCityLocation(filtered[0].long_name);
              //getCityLocation(results[0].address_components[2].long_name);

              console.log(results[0]);
              infowindow.setContent(results[0].formatted_address);
              infowindow.open(map, marker);
            } else {
              window.alert("No results found");
            }
          } else {
            window.alert("Geocoder failed due to: " + status);
          }
        });
      }
    </script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCLfsCnKb5tk6Qd2EyNOWKuf6XfeznAQXw&libraries=places&ensor=true&callback=initAutocomplete"
      async
      defer
    ></script>
    <script>
      $(function () {
        $('input[name="date"]').daterangepicker(
          {
            locale: {
              format: "DD/MM/YYYY",
              separator: " - ",
              applyLabel: "Zatwierdź",
              cancelLabel: "Anuluj",
              fromLabel: "Od",
              toLabel: "Do",
              customRangeLabel: "Custom",
              weekLabel: "W",
              daysOfWeek: ["Pn", "Wt", "Śr", "Cz", "Pt", "So", "Nd"],
              monthNames: [
                "Styczeń",
                "Luty",
                "Marzec",
                "Kwiecień",
                "Maj",
                "Czerwiec",
                "Lipiec",
                "Sierpień",
                "Wrzesień",
                "Październik",
                "Listopad",
                "Grudzień",
              ],
              firstDay: 0,
            },
            startDate: "28/04/2020",
            endDate: "05/04/2020",
          },
          function (start, end, label) {
            console.log(
              "New date range selected: " +
                start.format("YYYY-MM-DD") +
                " to " +
                end.format("YYYY-MM-DD") +
                " (predefined range: " +
                label +
                ")"
            );
          }
        );
      });
    </script>
  </body>
</html>
